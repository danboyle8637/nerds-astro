---
import BaseLayout from '../../layouts/Layout.astro'
import Footer from '../../sections/Footer/index.astro'
import MdxPostHeader from '../../components/blog/BlogComponents/MdxPostHeader.astro'
import type { MDXInstance } from 'astro'
import type { BlogPostFrontmatter } from '../../types/blog'

import Header2 from '../../components/blog/Header2.astro'
import Paragraph from '../../components/blog/Paragraph.astro'
import CodeCallout from '../../components/blog/CodeCallout.astro'
import PostImage from '../../components/blog/PostImage.astro'

interface Route {
  params: {
    now: string
  },
  props: {
    data: BlogPostFrontmatter,
    now: MDXInstance<Record<string, any>>
  }
}

export async function getStaticPaths() {
  const posts = await Astro.glob("../../data/now/*.mdx")

  const routes: Route[] = posts.map(post => {
    const frontmatter = post.frontmatter as BlogPostFrontmatter

    return ({
      params: { now: frontmatter.slug },
      props: {
        data: frontmatter,
        now: post
      }
    })
  })

  return routes
}

const { headline, seoTitle, seoDescription, headerImageUrl, altTag, titleTag, category, tags } = Astro.props.data as BlogPostFrontmatter
const { Content } = Astro.props.now
---

<BaseLayout title={seoTitle}>
  <div class="container">
    <MdxPostHeader 
      imageUrl={headerImageUrl}
      altTag={altTag}
      titleTag={titleTag}
      headline={headline}
      category={category}
      tags={tags}
    />
    <div class="galaxy"></div>
    <div class="post-body">
      <Content 
        components={{
          h2: Header2,
          p: Paragraph,
          em: CodeCallout,
          img: PostImage,
        }}
      />
    </div>
  </div>
  <Footer />
</BaseLayout>

<style lang="scss">
  @import "../../styles/sizes.scss";

  .container {
    position: relative;
    display: grid;
    grid-template-columns: 1fr;
    grid-auto-rows: min-content;
    gap: 80px;
    justify-items: center;
    width: 100%;
    isolation: isolate;
  }

  .post-body {
    padding: 0 12px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
    
    @include aboveMobile {
      width: 660px;
    }

    @include aboveTablet {
      width: 800px;
    }
  }

  .galaxy {
    position: absolute;
    top: 0;
    left: 0;
    background-color: #3d00bd;
    border-radius: 50%;
    width: 220px;
    height: 220px;
    filter: blur(160px);
    transform: translate(0, 260px);
    z-index: -1;

    @include aboveMobile {
      transform: translate(40px, 360px);
    }

    @include aboveTablet {
      width: 300px;
      height: 300px;
      filter: blur(260px);
      transform: translate(40px, 420px);
    }
  }
</style>